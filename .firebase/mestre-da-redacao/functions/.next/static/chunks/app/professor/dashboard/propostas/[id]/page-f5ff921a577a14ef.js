(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8500],{7002:function(e,t,o){Promise.resolve().then(o.bind(o,9861))},9861:function(e,t,o){"use strict";o.d(t,{default:function(){return x}});var a=o(9807),r=o(7694),s=o(259),n=o(2936),l=o(6976),i=o(8355),d=o(9488),c=o(4286),u=o(2787),p=o(6938),m=o(4616),f=o(3319);function x(e){var t;let{params:o}=e;console.log("=== DEBUG: In\xedcio do componente ==="),console.log("Params recebidos:",JSON.stringify(o,null,2));let x=null;if(null==o?void 0:o.id)x=o.id;else if(null==o?void 0:o.value)try{x=JSON.parse(o.value).id}catch(e){console.error("Erro ao parsear params.value:",e)}console.log("ID extra\xeddo:",x),console.log("DB inicializado:",!!l.db);let h=(0,s.useRouter)(),{toast:g}=(0,p.pm)(),{user:v,role:y}=(0,m.a)();console.log("User:",v),console.log("Role:",y);let[b,j]=(0,r.useState)(null),[N,E]=(0,r.useState)(!0),[w,S]=(0,r.useState)(null),[D,A]=(0,r.useState)(!1),[T,I]=(0,r.useState)(!1),[k,z]=(0,r.useState)([]),O=()=>"professor"===y?"/professor/dashboard/propostas":"/dashboard/propostas";(0,r.useEffect)(()=>{async function e(){try{if(!l.db)throw console.error("DB n\xe3o inicializado"),Error("Erro de conex\xe3o com o banco de dados");if(!x){console.error("=== DEBUG: ID inv\xe1lido ==="),console.error("ID extra\xeddo:",x),S("ID da proposta inv\xe1lido"),g({title:"Erro",description:"O ID da proposta \xe9 inv\xe1lido.",variant:"destructive"}),E(!1);return}console.log("=== DEBUG: Buscando proposta ==="),console.log("ID da proposta:",x),console.log("Tipo do ID:",typeof x),console.log("Comprimento do ID:",x.length);let e=(0,n.JU)(l.db,"essayThemes",x);console.log("DocRef criado:",e);let t=await (0,n.QT)(e);if(console.log("DocSnap recebido:",t),console.log("DocSnap existe:",t.exists()),console.log("Dados do DocSnap:",t.data()),t.exists()){console.log("Proposta encontrada:",t.data());let e=t.data();if(!e)throw Error("Dados da proposta n\xe3o encontrados");j({id:t.id,...e})}else console.log("Proposta n\xe3o encontrada"),S("Proposta n\xe3o encontrada"),g({title:"Proposta n\xe3o encontrada",description:"A proposta que voc\xea est\xe1 procurando n\xe3o existe.",variant:"destructive"})}catch(e){console.error("=== DEBUG: Erro ao carregar proposta ==="),console.error("Erro completo:",e),console.error("Tipo do erro:",typeof e),console.error("Mensagem do erro:",e instanceof Error?e.message:"Erro desconhecido"),S("Desculpe, n\xe3o foi poss\xedvel carregar os detalhes da proposta. Por favor, tente novamente mais tarde."),g({title:"Erro ao carregar proposta",description:"Ocorreu um erro ao carregar os detalhes da proposta.",variant:"destructive"})}finally{E(!1)}}async function t(){if(x)try{let e=(0,n.IO)((0,n.hJ)(l.db,"essays"),(0,n.ar)("themeId","==",x)),t=await (0,n.PL)(e),o=[];t.forEach(e=>{o.push({id:e.id,...e.data()})}),z(o)}catch(e){console.error("Erro ao buscar reda\xe7\xf5es submetidas:",e)}}console.log("=== DEBUG: In\xedcio do useEffect ==="),l.db?(e(),x&&t()):(console.error("Firebase n\xe3o inicializado"),S("Erro de conex\xe3o com o banco de dados. Por favor, tente novamente mais tarde."),E(!1))},[x,h,g]),console.log("Estado atual:",{loading:N,proposta:b,error:w});let _=async()=>{try{I(!0),await (0,n.r7)((0,n.JU)(l.db,"essayThemes",x),{active:!1}),g({title:"Proposta exclu\xedda",description:"A proposta foi exclu\xedda com sucesso.",variant:"default"}),h.push(O())}catch(e){console.error("Erro ao excluir proposta:",e),g({title:"Erro ao excluir proposta",description:"Ocorreu um erro ao excluir a proposta. Tente novamente.",variant:"destructive"})}finally{I(!1),A(!1)}};return N?(console.log("Renderizando loading state"),(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})})):w?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen space-y-4",children:[(0,a.jsx)(d.Z,{className:"h-12 w-12 text-red-500"}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Ops! Algo deu errado"}),(0,a.jsx)("p",{className:"text-gray-500 text-center max-w-md",children:w}),(0,a.jsx)(i.z,{onClick:()=>h.push(O()),children:"Voltar para lista de propostas"})]}):b?(console.log("Renderizando conte\xfado da proposta"),(0,a.jsxs)("div",{className:"max-w-2xl mx-auto mt-8 space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-2",children:b.title}),(0,a.jsx)(i.z,{variant:"destructive",onClick:()=>A(!0),disabled:T,children:T?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mr-2 h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}),"Excluindo..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.Z,{className:"mr-2 h-4 w-4"}),"Excluir"]})})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-4 text-sm text-gray-600",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold",children:"Categoria:"})," ","ENEM_MESTRE"===b.category?"ENEM (Mestre da Reda\xe7\xe3o)":"ENEM_PASSADO"===b.category?"ENEM (Edi\xe7\xf5es passadas)":b.category]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold",children:"Criada em:"})," ",null===(t=b.createdAt)||void 0===t?void 0:t.toDate().toLocaleDateString()]})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:b.tags.map((e,t)=>(0,a.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs",children:e},t))}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("span",{className:"font-semibold block mb-2",children:"Arquivo da proposta:"}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(u.Z,{className:"h-6 w-6 text-gray-400"}),(0,a.jsx)("span",{className:"font-medium text-sm",children:b.file.name}),(0,a.jsx)(i.z,{variant:"outline",size:"sm",onClick:()=>window.open(b.file.url,"_blank"),children:"Baixar"})]}),(()=>{let e=b.file.name||"",t=b.file.url||"",o=e.toLowerCase(),r=t.toLowerCase(),s=o.endsWith(".pdf")||r.endsWith(".pdf"),n=[".jpg",".jpeg",".png",".gif"].some(e=>o.endsWith(e)||r.endsWith(e)),l=o.endsWith(".txt")||r.endsWith(".txt"),i=[".doc",".docx"].some(e=>o.endsWith(e)||r.endsWith(e));return s?(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)("iframe",{src:"".concat(b.file.url,"#toolbar=0"),className:"w-full h-[500px] rounded-md border",title:b.file.name,allow:"autoplay"})}):n?(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)("img",{src:b.file.url,alt:b.file.name,className:"max-h-[500px] w-auto rounded-md border mx-auto"})}):l?(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)("iframe",{src:b.file.url,className:"w-full h-[500px] rounded-md border bg-white",title:b.file.name})}):i?(0,a.jsx)("div",{className:"mt-4 text-gray-500 text-sm",children:"Pr\xe9-visualiza\xe7\xe3o n\xe3o suportada para arquivos Word. Fa\xe7a o download para visualizar."}):(0,a.jsx)("div",{className:"mt-4 text-gray-500 text-sm",children:"Tipo de arquivo n\xe3o suportado para pr\xe9-visualiza\xe7\xe3o. Fa\xe7a o download para visualizar."})})()]})]}),(0,a.jsx)(f.aR,{open:D,onOpenChange:A,children:(0,a.jsxs)(f._T,{children:[(0,a.jsxs)(f.fY,{children:[(0,a.jsx)(f.f$,{children:"Confirmar exclus\xe3o"}),(0,a.jsx)(f.yT,{children:"Tem certeza que deseja excluir esta proposta? Esta a\xe7\xe3o n\xe3o pode ser desfeita."})]}),(0,a.jsxs)(f.xo,{children:[(0,a.jsx)(f.le,{children:"Cancelar"}),(0,a.jsx)(f.OL,{onClick:_,children:"Confirmar"})]})]})})]})):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen space-y-4",children:[(0,a.jsx)(d.Z,{className:"h-12 w-12 text-yellow-500"}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Proposta n\xe3o encontrada"}),(0,a.jsx)("p",{className:"text-gray-500 text-center max-w-md",children:"A proposta que voc\xea est\xe1 procurando n\xe3o existe ou foi removida."}),(0,a.jsx)(i.z,{onClick:()=>h.push(O()),children:"Voltar para lista de propostas"})]})}},3319:function(e,t,o){"use strict";o.d(t,{OL:function(){return h},_T:function(){return u},aR:function(){return i},f$:function(){return f},fY:function(){return p},le:function(){return g},xo:function(){return m},yT:function(){return x}});var a=o(9807),r=o(7694),s=o(7148),n=o(9456),l=o(8355);let i=s.fC;s.xz;let d=s.h_,c=r.forwardRef((e,t)=>{let{className:o,...r}=e;return(0,a.jsx)(s.aV,{className:(0,n.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",o),...r,ref:t})});c.displayName=s.aV.displayName;let u=r.forwardRef((e,t)=>{let{className:o,...r}=e;return(0,a.jsxs)(d,{children:[(0,a.jsx)(c,{}),(0,a.jsx)(s.VY,{ref:t,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",o),...r})]})});u.displayName=s.VY.displayName;let p=e=>{let{className:t,...o}=e;return(0,a.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...o})};p.displayName="AlertDialogHeader";let m=e=>{let{className:t,...o}=e;return(0,a.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...o})};m.displayName="AlertDialogFooter";let f=r.forwardRef((e,t)=>{let{className:o,...r}=e;return(0,a.jsx)(s.Dx,{ref:t,className:(0,n.cn)("text-lg font-semibold",o),...r})});f.displayName=s.Dx.displayName;let x=r.forwardRef((e,t)=>{let{className:o,...r}=e;return(0,a.jsx)(s.dk,{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",o),...r})});x.displayName=s.dk.displayName;let h=r.forwardRef((e,t)=>{let{className:o,...r}=e;return(0,a.jsx)(s.aU,{ref:t,className:(0,n.cn)((0,l.d)(),o),...r})});h.displayName=s.aU.displayName;let g=r.forwardRef((e,t)=>{let{className:o,...r}=e;return(0,a.jsx)(s.$j,{ref:t,className:(0,n.cn)((0,l.d)({variant:"outline"}),"mt-2 sm:mt-0",o),...r})});g.displayName=s.$j.displayName},8355:function(e,t,o){"use strict";o.d(t,{d:function(){return i},z:function(){return d}});var a=o(9807),r=o(7694),s=o(2931),n=o(6640),l=o(9456);let i=(0,n.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",terciary:"bg-background border border-primary text-primary hover:bg-primary/10"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=r.forwardRef((e,t)=>{let{className:o,variant:r,size:n,asChild:d=!1,...c}=e,u=d?s.g7:"button";return(0,a.jsx)(u,{className:(0,l.cn)(i({variant:r,size:n,className:o})),ref:t,...c})});d.displayName="Button"},6938:function(e,t,o){"use strict";o.d(t,{pm:function(){return p}});var a=o(7694);let r=0,s=new Map,n=e=>{if(s.has(e))return;let t=setTimeout(()=>{s.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);s.set(e,t)},l=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:o}=t;return o?n(o):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===o||void 0===o?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},i=[],d={toasts:[]};function c(e){d=l(d,e),i.forEach(e=>{e(d)})}function u(e){let{...t}=e,o=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>c({type:"DISMISS_TOAST",toastId:o});return c({type:"ADD_TOAST",toast:{...t,id:o,open:!0,onOpenChange:e=>{e||a()}}}),{id:o,dismiss:a,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:o}})}}function p(){let[e,t]=a.useState(d);return a.useEffect(()=>(i.push(t),()=>{let e=i.indexOf(t);e>-1&&i.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},4616:function(e,t,o){"use strict";o.d(t,{AuthProvider:function(){return d},a:function(){return c}});var a=o(9807),r=o(7694),s=o(2936),n=o(6976),l=o(5200);let i=(0,r.createContext)(null);function d(e){let{children:t}=e,[o,d]=(0,r.useState)(null),[c,u]=(0,r.useState)(null),[p,m]=(0,r.useState)(!0),[f,x]=(0,r.useState)(null),h=async e=>{try{let t=(0,s.JU)(n.db,"users",e.uid);await (0,s.oe)(t),console.log("Documento do usu\xe1rio deletado com sucesso"),await (0,l.h8)(e),console.log("Usu\xe1rio deletado do Auth com sucesso"),d(null),u(null),x(null)}catch(e){throw console.error("Erro ao limpar usu\xe1rio:",e),e}},g=async(e,t,o)=>{try{console.log("Iniciando cria\xe7\xe3o do documento do usu\xe1rio:",e.uid);let a=(0,s.JU)(n.db,"users",e.uid);if(!(await (0,s.QT)(a)).exists()){console.log("Criando novo documento para o usu\xe1rio");let r={id:e.uid,name:t,email:e.email||"",role:"student",createdAt:(0,s.Bt)(),lastLogin:(0,s.Bt)()};return console.log("Dados do novo usu\xe1rio:",r),await (0,s.pl)(a,r,{merge:!1}),console.log("Documento criado com sucesso"),await (0,s.ET)((0,s.hJ)(n.db,"subscriptions"),{userId:e.uid,type:"MESTRE_AMIGO"===o?"private":"free",status:"active",createdAt:(0,s.Bt)(),updatedAt:(0,s.Bt)(),tokens:{available:0,unlimited:"MESTRE_AMIGO"===o}}),console.log("Assinatura criada com sucesso"),x("student"),u(t),r}return null}catch(e){throw console.error("Erro ao criar documento do usu\xe1rio:",e),e}},v=async e=>{try{let t=await (0,s.QT)((0,s.JU)(n.db,"users",e));if(t.exists()){let e=t.data();return u(e.name),x(e.role),e}return null}catch(e){return console.error("Erro ao buscar dados do usu\xe1rio:",e),null}};return(0,r.useEffect)(()=>{let e=n.I8.onAuthStateChanged(async e=>{console.log("Auth state changed, user:",null==e?void 0:e.uid),d(e),m(!0);try{e?await v(e.uid)||(u(null),x(null)):(u(null),x(null),console.log("User logged out, role set to null"))}catch(e){console.error("Erro ao carregar dados do usu\xe1rio:",e),x(null),u(null)}finally{m(!1)}});return()=>e()},[]),(0,a.jsx)(i.Provider,{value:{user:o,userName:c,loading:p,role:f,createUserDocument:g,cleanupUserOnError:h,fetchUserData:v,updateLastLogin:e=>{let t=(0,s.JU)(n.db,"users",e);(0,s.pl)(t,{lastLogin:(0,s.Bt)()},{merge:!0}).catch(e=>{console.error("Erro ao atualizar lastLogin:",e)})}},children:t})}function c(){let e=(0,r.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},6976:function(e,t,o){"use strict";let a,r,s;o.d(t,{I8:function(){return a},db:function(){return r},tO:function(){return s}});var n=o(3631),l=o(3797),i=o(5200),d=o(2936),c=o(9542);let u={apiKey:"AIzaSyABZJxTb4i_SDIBE-j530FN1cGBwmkB054",authDomain:"mestre-da-redacao.firebaseapp.com",projectId:"mestre-da-redacao",storageBucket:"mestre-da-redacao.firebasestorage.app",messagingSenderId:"326080016742",appId:"1:326080016742:web:239aa8c38ec32dcfe018a7"};console.log("Configura\xe7\xe3o do Firebase:",{...u,apiKey:"***"});let p=(0,n.ZF)(u),m=null;try{console.log("App Firebase inicializado:",p.name),m=(0,l.IH)(p),a=(0,i.v0)(p),r=(0,d.ad)(p),s=(0,c.getStorage)(p),console.log("Servi\xe7os Firebase inicializados:",{auth:!!a,db:!!r,analytics:!!m,storage:!!s})}catch(e){throw console.error("Erro ao inicializar Firebase:",e),e}},9456:function(e,t,o){"use strict";o.d(t,{cn:function(){return s}});var a=o(8223),r=o(6257);function s(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];return(0,r.m6)((0,a.W)(t))}},9488:function(e,t,o){"use strict";o.d(t,{Z:function(){return a}});let a=(0,o(6875).Z)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},4286:function(e,t,o){"use strict";o.d(t,{Z:function(){return a}});let a=(0,o(6875).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])}},function(e){e.O(0,[5453,291,3727,5624,1013,6294,9950,4315,514,1744],function(){return e(e.s=7002)}),_N_E=e.O()}]);